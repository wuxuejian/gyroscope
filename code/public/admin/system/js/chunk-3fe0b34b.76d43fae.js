(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3fe0b34b"],{"1a2e":function(t,e,a){"use strict";a("3dd0")},"239e":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"station"},[a("el-drawer",{attrs:{"append-to-body":!0,"before-close":t.handleClose,direction:t.direction,modal:!0,size:t.formData.width,title:t.formData.title,visible:t.drawer,"wrapper-closable":!0},on:{"update:visible":function(e){t.drawer=e}}},[a("div",{staticClass:"step"},[a("span",{staticClass:"public",class:1==t.activeIndex?"active":""},[t._v("1")]),t._v(" "),a("span",{staticClass:"step-text",class:1==t.activeIndex?"activeText":""},[t._v("选择付款订单")]),t._v(" "),a("span",{staticClass:"line-title"}),t._v(" "),a("span",{staticClass:"public",class:2==t.activeIndex?"active":""},[t._v("2")]),t._v(" "),a("span",{staticClass:"step-text",class:2==t.activeIndex?"activeText":""},[t._v("填写发票信息")])]),t._v(" "),2==t.activeIndex&&0==t.rules.bill_id.length?a("div",{staticClass:"alert"},[a("el-alert",{staticClass:"cr-alert",attrs:{description:"请注意,您没有选择该发票关联的付款订单！","show-icon":"",type:"info"}})],1):t._e(),t._v(" "),1==t.activeIndex?a("div",{staticClass:"mt20"},["edit"==t.formData.type?a("el-button",{staticClass:"mb14",attrs:{size:"small",type:"primary"},on:{click:t.addPaymentFn}},[t._v("添加其他付款单")]):t._e(),t._v(" "),a("paymentTable",{ref:"paymentTable",attrs:{edit:t.edit,tableData:t.tableData1},on:{handleSelectionFn:t.handleSelectionChange,totalFn:t.totalFn}})],1):t._e(),t._v(" "),2==t.activeIndex?a("div",{staticClass:"mt20"},[a("div",{staticClass:"mb50"},[a("approval-edit",{ref:"approval",attrs:{commandId:t.commandId,parameterData:t.parameterData}})],1)]):t._e(),t._v(" "),a("div",{staticClass:"button from-foot-btn fix btn-shadow"},[a("el-button",{attrs:{size:"small"},on:{click:t.handleClose}},[t._v(t._s(1==t.activeIndex?"取消":"上一步"))]),t._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.handleConfirm()}}},[t._v("\n          "+t._s(1==t.activeIndex?"下一步":"确定")+"\n        ")])],1)]),t._v(" "),a("el-dialog",{attrs:{"append-to-body":!0,visible:t.addPayment,title:"选择申请开票付款单",width:"1100px"},on:{"update:visible":function(e){t.addPayment=e},close:t.cancelFn}},[a("div",{staticClass:"line"}),t._v(" "),a("paymentTable",{attrs:{edit:t.edit,ids:t.rules.bill_id,tableData:t.tableData2},on:{handleSelectionFn:t.pushTableFn}}),t._v(" "),a("div",{staticClass:"footer"},[a("el-button",{staticClass:"btn",attrs:{size:"small"},on:{click:t.cancelFn}},[t._v("取消")]),t._v(" "),a("el-button",{staticClass:"btn",attrs:{size:"small",type:"primary"},on:{click:t.okFn}},[t._v("确定")])],1)],1)],1)])},r=[],s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"paymentTable"},[a("el-table",{key:t.edit,staticStyle:{width:"100%"},attrs:{data:t.table},on:{"selection-change":t.handleSelectionChange}},[""===t.edit?a("el-table-column",{attrs:{type:"selection",width:"55"}}):t._e(),t._v(" "),a("el-table-column",{attrs:{prop:"bill_no",label:"付款单号","min-width":"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"treaty.contract_name",label:"合同名称","min-width":"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"types",label:"业务类型","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.types?a("span",[t._v("回款记录")]):t._e(),t._v(" "),1===e.row.types?a("span",[t._v("续费记录 "),e.row.renew.title?a("span",[t._v("-")]):t._e(),t._v(t._s(e.row.renew.title))]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"num",label:"付款金额(元)","min-width":"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"发票状态","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.status?a("div",[-1===e.row.status?a("span",{staticClass:"table-btn blue"},[t._v(" 开票撤回 ")]):t._e(),t._v(" "),0===e.row.status?a("span",{staticClass:"table-btn gray"},[t._v(" 待开票 ")]):t._e(),t._v(" "),1===e.row.status?a("span",{staticClass:"table-btn yellow"},[t._v(" 已开票 ")]):t._e(),t._v(" "),2===e.row.status?a("span",{staticClass:"table-btn red"},[t._v(" 已拒绝 ")]):t._e(),t._v(" "),3===e.row.status?a("span",{staticClass:"table-btn green"},[t._v(" 申请作废 ")]):t._e(),t._v(" "),4===e.row.status?a("span",{staticClass:"table-btn red"},[t._v(" 同意作废 ")]):t._e(),t._v(" "),5===e.row.status?a("span",{staticClass:"table-btn gray"},[t._v(" 拒绝作废 ")]):t._e(),t._v(" "),6===e.row.status?a("span",{staticClass:"table-btn yellow"},[t._v(" 作废撤回 ")]):t._e()]):a("div",[t._v("--")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"card.name",label:"创建人","min-width":"90"}}),t._v(" "),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间","min-width":"150"}}),t._v(" "),""!==t.edit?a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.deleteFn(e.row)}}},[t._v("移除")])]}}],null,!1,2654715795)}):t._e()],1),t._v(" "),t.isImage?a("el-image-viewer",{attrs:{"on-close":t.closeImageViewer,"url-list":t.srcList}}):t._e()],1)},n=[],l=a("08a9"),o={name:"",components:{ElImageViewer:l["default"]},props:["tableData","edit","ids"],data:function(){return{table:[],isImage:!1,srcList:[],multipleSelection:[],total:0}},watch:{tableData:{handler:function(t){this.table=t}},ids:{handler:function(t){this.multipleSelection=t}}},methods:{handleSelectionChange:function(t){this.$emit("handleSelectionFn",t)},closeImageViewer:function(){this.isImage=!1,this.srcList=[]},handlePictureCardPreview:function(t){this.srcList.push(t),this.isImage=!0},deleteFn:function(t){var e=this;this.$modalSure("确认移除此付款订单吗").then((function(){e.table=e.table.filter((function(e){return e.id!=t.id})),e.$emit("totalFn",e.total,e.table)}))}}},c=o,d=(a("84b9"),a("2877")),u=Object(d["a"])(c,s,n,!1,null,"05be9614",null),m=u.exports,h=a("a30a"),p=a("6b64");function b(t){return g(t)||_(t)||f(t)||v()}function v(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(t,e){if(t){if("string"===typeof t)return w(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?w(t,e):void 0}}function _(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function g(t){if(Array.isArray(t))return w(t)}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}var y={name:"MergeInvoice",props:{contractInvoice:{type:String,default:""},formData:{type:Object,default:function(){return{}}},parameterData:{type:Object,default:function(){return{}}}},components:{paymentTable:m,approvalEdit:function(){return a.e("chunk-7e8c1d31").then(a.bind(null,"90a4"))}},data:function(){var t=this,e=function(e,a,i){return!a&&t.rules.invoiceType>1?i(new Error(t.$t("customer.placeholder47"))):p["a"].identReg.test(a)?i():i(new Error("税号输入不合法"))};return{radio:1,edit:"",linkId:0,commandId:0,drawer:!1,addPayment:!1,obtainEid:"",obtainCid:"",direction:"rtl",tableData1:[],tableData2:[],pushTable:[],categoryList:[],invoiceOptions:[{value:1,label:this.$t("customer.personalinvoice")},{value:2,label:this.$t("customer.enterpriseinvoice")},{value:3,label:this.$t("customer.specialinvoice")}],methodOptions:[{value:"express",label:this.$t("customer.express")},{value:"mail",label:this.$t("customer.mail")}],activeIndex:1,withdraw:"",rules:{name:"",source:"",price:"0",amount:void 0,billDate:"",invoiceType:2,title:"",ident:"",collect_type:"mail",bank:"",address:"",account:"",tel:"",mark:"",collect_name:"",collect_tel:"",mail_address:"",collect_email:"",category_id:"",bill_id:[]},newFormData:{},rule:{name:[{required:!0,message:this.$t("customer.placeholder42"),trigger:"blur"}],amount:[{required:!0,message:this.$t("customer.placeholder44"),trigger:"blur"}],billDate:[{required:!0,message:this.$t("customer.placeholder65"),trigger:"blur"}],title:[{required:!0,message:this.$t("customer.placeholder46"),trigger:"blur"}],ident:[{required:!0,validator:e,trigger:"blur"}],category_id:[{required:!0,message:"请选择发票类目",trigger:"change"}],collect_name:[{required:!0,message:"电话号码不能为空",trigger:"blur"}],collect_tel:[{required:!0,message:"电话号码不能为空",trigger:"blur"}],collect_email:[{required:!0,message:"邮箱地址不能为空",trigger:"blur"}],mail_address:[{required:!0,message:"邮寄地址不能为空",trigger:"blur"}],address:[{required:!0,message:this.$t("customer.placeholder56"),trigger:"blur"}],bank:[{required:!0,message:this.$t("customer.placeholder48"),trigger:"blur"}],account:[{required:!0,message:this.$t("customer.placeholder49"),trigger:"blur"}],tel:[{required:!0,message:"电话号码不能为空",trigger:"blur"}]}}},watch:{formData:{handler:function(t){if(this.newFormData=t,this.edit=t.type,"edit"==t.type){for(var e in this.rules)this.rules[e]=t.rowData[e];this.rules.source=t.rowData.client?t.rowData.client.name:"",""==t.rowData.account?this.rules.account=this.rules.price:this.rules.account=t.rowData.account,this.rules.invoiceType=Number(t.rowData.types)}else if(t.data&&(this.rules.source=t.data.name?t.data.name:"--"),t.oneData){for(var a in this.rules)this.rules[a]=t.oneData[a];this.rules.invoiceType=Number(t.oneData.types)}},immediate:!0,deep:!0}},methods:{openBox:function(t){var e=this;this.commandId=t,setTimeout((function(){"edit"==e.edit?(e.editPaymentRecord(),e.$nextTick((function(){e.$refs.paymentTable.edit="edit"}))):e.getPaymentRecord(),e.rules.billDate=e.$moment(new Date).format("YYYY-MM-DD")}),300),this.drawer=!0},cancelFn:function(){this.edit="edit",this.addPayment=!1},okFn:function(){var t=this;this.rules.bill_id=[];var e=[],a=JSON.parse(localStorage.getItem("paymentOrderList"));this.pushTable.forEach((function(e){a.push(e),t.addPayment=!1,t.tableData1=t.unique(a),t.edit="edit"})),localStorage.setItem("paymentOrderList",JSON.stringify(this.tableData1)),this.tableData1.map((function(a){t.rules.bill_id.push(a.id),e.push(a.num)}));var i=e.map(Number);this.rules.price=i.reduce((function(t,e){return t+e})).toFixed(2),this.rules.amount=this.rules.price},unique:function(t){var e=new Map;return t.filter((function(t){return!e.has(t.id)&&e.set(t.id,1)}))},pushTableFn:function(t){this.pushTable=t},totalFn:function(t,e){var a=this;localStorage.setItem("paymentOrderList",JSON.stringify(e));var i=[];if(this.rules.bill_id=[],0==e.length)this.rules.bill_id.length=0;else{e.map((function(t){a.rules.bill_id.push(t.id),i.push(t.num)}));var r=i.map(Number);this.rules.price=r.reduce((function(t,e){return t+e})).toFixed(2),this.rules.amount=this.rules.price}},getPaymentRecord:function(){var t=this,e={eid:"",cid:"",withdraw:this.withdraw};e.eid=this.newFormData.data.eid,e.cid=this.newFormData.data.cid,Object(h["fe"])(e).then((function(e){t.tableData1=e.data,localStorage.setItem("paymentOrderList",JSON.stringify(t.tableData1))}))},editPaymentRecord:function(){var t=this,e={eid:this.newFormData.rowData.eid,invoice_id:this.newFormData.rowData.id,withdraw:this.withdraw};Object(h["fe"])(e).then((function(e){t.tableData1=e.data,localStorage.setItem("paymentOrderList",JSON.stringify(t.tableData1)),t.tableData1.map((function(e){t.rules.bill_id.push(e.id)}))}))},getPayment:function(){var t=this;if(this.newFormData.rowData){var e={eid:this.newFormData.rowData.eid,withdraw:this.withdraw};Object(h["fe"])(e).then((function(e){t.tableData2=e.data}))}},addPaymentFn:function(){this.edit="",this.addPayment=!0,this.withdraw=1,this.getPayment()},handleSelectionChange:function(t){var e=this;"[]"==JSON.stringify(t)&&(this.rules.bill_id.length=0),this.rules.bill_id=[];var a=[];t.map((function(t){e.rules.bill_id.push(t.id),a.push(t.num)})),this.parameterData.bill_id=this.rules.bill_id;var i=a.map(Number);this.rules.price=i.reduce((function(t,e){return t+e})).toFixed(2),this.rules.amount=this.rules.price},handleConfirm:function(){var t=this,e=0,a=0;"is_contract"==this.contractInvoice?(e=this.formData.data.eid,a=this.formData.data.id):(e=this.formData.data.id,a=this.formData.data.cid),1==this.activeIndex?(this.activeIndex=2,"[]"!==JSON.stringify(this.rules.bill_id)&&(this.rules.bill_id=b(new Set(this.rules.bill_id))),this.parameterData.bill_id=this.rules.bill_id):this.commandId?(this.$refs.approval.handleConfirm(),setTimeout((function(){t.drawer=!1,t.$emit("getTableData")}),2e3)):this.$refs.tableform.validate((function(i){if(i){var r=t.rules;r.cid=t.formData.rowData?t.formData.rowData.cid:a,r.eid=t.formData.rowData?t.formData.rowData.eid:e;var s={eid:r.eid,category_id:t.rules.category_id},n=JSON.parse(localStorage.getItem("categoryList"));if(n&&0!==n.length){var l=n.find((function(t){return t.eid==r.eid}));l?n.map((function(t){t.eid==s.eid&&(t.category_id=s.category_id)})):n.push(s)}localStorage.setItem("categoryList",JSON.stringify(n)),"edit"==t.edit?t.invoicePut(t.newFormData.rowData.id,r):t.invoiceSave(r)}}))},invoiceSave:function(t){var e=this;Object(h["Gb"])(t).then((function(t){200==t.status&&(e.drawer=!1,e.activeIndex=1,e.$emit("isOk"),localStorage.removeItem("paymentOrderList"))}))},invoicePut:function(t,e){var a=this;Object(h["Fb"])(t,e).then((function(t){200==t.status&&(a.drawer=!1,a.activeIndex=1,a.$emit("isOk"),a.rest(),localStorage.removeItem("paymentOrderList"))}))},handleClose:function(){var t=this;if(1==this.activeIndex)this.drawer=!1,this.rest();else{this.activeIndex=1;var e=JSON.parse(localStorage.getItem("paymentOrderList"));this.$nextTick((function(){t.$set(t,"tableData1",e)})),this.getPayment()}},rest:function(){for(key in this.activeIndex=1,this.rules)this.rules[key]="";this.rules.price="0",this.rules.amount=void 0,this.rules.invoiceType=2,this.rules.collect_type="mail",this.rules.bill_id=[]}}},D=y,I=(a("1a2e"),Object(d["a"])(D,i,r,!1,null,"9b0000d4",null));e["default"]=I.exports},"3dd0":function(t,e,a){},"84b9":function(t,e,a){"use strict";a("8e08")},"8e08":function(t,e,a){}}]);