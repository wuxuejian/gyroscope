(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7e8c1d31"],{"11ec":function(e,t,a){},"76c0":function(e,t,a){"use strict";a("11ec")},"90a4":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"ex-content"},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("div",{staticClass:"ex-content-con"},[a("div",{staticClass:"acea-row mb20"},[a("div",{staticClass:"shu mr10"}),e._v(" "),a("span",{staticClass:"title"},[e._v("提交审批")])]),e._v(" "),a("form-create",{ref:"fc",staticClass:"edit-examine-form",attrs:{option:e.option,size:"small",rule:e.rules},on:{change:e.handleChange},model:{value:e.fapi,callback:function(t){e.fapi=t},expression:"fapi"}}),e._v(" "),e.configData&&0!=e.configData.examine?a("el-divider"):e._e(),e._v(" "),e.configData&&0!=e.configData.examine?a("process-from",{attrs:{"examine-data":e.examineData,"edit-user":e.editUser}}):e._e()],1)])],1),e._v(" "),a("div",{staticClass:"button from-foot-btn fix btn-shadow"},[a("el-button",{attrs:{size:"small"},on:{click:e.handleClose}},[e._v(e._s(e.$t("public.cancel")))]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary",loading:e.loading},on:{click:function(t){return e.handleConfirm("ruleForm")}}},[e._v("\n      "+e._s(e.$t("public.ok"))+"\n    ")])],1)])},n=[],r=a("0c6d"),o=a("2b6d");function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t,a){return t=c(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e){var t=p(e,"string");return"symbol"==l(t)?t:t+""}function p(e,t){if("object"!=l(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!=l(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var u={name:"EditExamine",components:{processFrom:function(){return Promise.resolve().then(a.bind(null,"7a76"))}},props:{parameterData:{type:Object,default:function(){return{}}},commandId:{type:Number,default:0}},data:function(){var e=this;return s({fapi:null,abnormal:"",record:"",holiday:"",abnormal_id:"",record_id:0,holiday_id:0,abnormal_label:"",record_label:"",calculateType:"",option:{form:{labelWidth:"120px"},submitBtn:!1,global:{frame:{props:{closeBtn:!1,okBtn:!1,onLoad:function(t){t.fApi=e.$refs.fc.$f}}}}},rules:[],configData:null,formData:{},isRequest:!0,examineData:{},id:0,isEdit:!1,loading:!1,editUser:!1,approverDelete:!0,copyerDelete:!0,tryDateOptions:null,tryYiChangOptions:null},"configData",null)},created:function(){this.attendanceAbnormalDate()},mounted:function(){this.approveApply()},methods:{handleClose:function(){this.close()},close:function(){this.drawer=!1,this.id=0},approveApply:function(){var e=this;Object(o["e"])(this.commandId,this.parameterData).then((function(t){e.configData=t.data.info,t.data.forms.forEach((function(t){"moneyFrom"!==t.type&&"inputNumber"!==t.type||!t.props||(t.props.max&&(t.props.max=Number(t.props.max)),t.props.min&&(t.props.min=Number(t.props.min)),t.props.precision&&(t.props.precision=Number(t.props.precision))),t.children&&t.children.forEach((function(t){"异常日期"==t.title&&(e.abnormal=t.field),"异常记录"==t.title&&(e.record=t.field)}))})),e.rules=[],t.data.forms.map((function(t){t.children?t.children.map((function(a){a.calculateType=t.type,e.calculateType=t.type,"异常日期"===a.title&&"refillFrom"===a.calculateType&&(a.options=e.tryDateOptions),e.rules.push(a)})):(t.calculateType=t.type,e.rules.push(t))})),e.isEdit?e.approveApplyEdit(e.id,{types:0}):(e.drawer=!0,e.$nextTick((function(){var t=e.handleFromObj();e.approveApplyList(e.commandId,t)})))}))},approveApplyList:function(e,t){var a=this;Object(o["f"])(e,t).then((function(e){a.examineData=e.data;var t=e.data.rules;if(t.edit){var i=t.edit+"";a.approverDelete=i.includes("1"),a.copyerDelete=i.includes("2")}t.edit&&i.length>0?a.examineData.list.length>0&&a.examineData.list.map((function(e){1==e.types&&(t.abnormal>0&&(2===e.settype||7===e.settype)&&e.users.length<=0&&e.users.push(t),i.includes("1")?e.users.map((function(e){e.isDelete=!0})):a.editUser=!0),2==e.types&&i.includes("2")&&e.users.map((function(e){e.isDelete=!0}))})):a.editUser=!0}))},handleChange:function(e){var t,a,i=this,n=["liaisonMan","telephone","mailingAddress"],r=this.handleFromObj();if(this.rules.forEach((function(a){"express"==r[e]?(n.includes(a.symbol)&&(a.hidden=!1),"invoicingEmail"==a.symbol&&(a.hidden=!0)):"mail"==r[e]&&(n.includes(a.symbol)&&(a.hidden=!0),"invoicingEmail"==a.symbol&&(a.hidden=!1)),1==i.fapi.rule[9].value?"dutyParagraph"==a.symbol&&(a.hidden=!0,a.effect.required=!0):"dutyParagraph"==a.symbol&&(a.hidden=!1,a.effect.required=!1),JSON.stringify(t)&&"timeFrom"==a.type&&(a.props.timeType=0==t?"day":"time")})),"time"==r[e].timeType){var o=r[e].dateStart,l=r[e].dateEnd,s=new Date(o),c=new Date(l),p=c-s,u=36e5,d=p/u;r[e].duration=d?d.toFixed(2):""}for(var f in this.tryDateOptions&&this.tryDateOptions.map((function(t){t.value==r[e]&&(i.abnormal_label=t.label)})),this.tryYiChangOptions&&this.tryYiChangOptions.map((function(t){t.value==r[e]&&(i.record_label=t.label)})),r)r[f]==r[e]&&(a=f),f==this.abnormal&&(this.abnormal_id=r[f]),f==this.record&&(this.record_id=r[f]),f==this.holiday&&(this.holiday_id=r[f]);a==this.abnormal&&this.attendanceAbnormalRecord(r[e]),this.isEdit?this.approveApplyList(this.configData.approve_id,r):this.approveApplyList(this.commandId,r)},approveApplyEdit:function(e,t){var a=this;Object(o["c"])(e,t).then((function(e){a.drawer=!0;var t=e.data;a.rules.map((function(e){t[e.field]&&(e.value=t[e.field])})),a.rules.map((function(e){"异常日期"==e.title&&(a.attendanceAbnormalDate(),e.value.abnormal_id&&(a.abnormal_id=e.value.abnormal_id.value,a.abnormal_label=e.value.abnormal_id.label),e.value=a.abnormal_label,a.attendanceAbnormalRecord(a.abnormal_id))})),a.$nextTick((function(){var e=a.handleFromObj();a.approveApplyList(a.configData.approve_id,e)}))}))},handleFromData:function(){var e=[];return this.fapi.rule.map((function(t){var a={};a[t.field]=t.value?t.value:"",e.push(a)})),e},handleFromObj:function(){for(var e={},t=this.fapi.rule,a=0;a<t.length;a++){"[object Object]"===Object.prototype.toString.call(t[a].value)&&(t[a].value.type=t[a].calculateType);var i=t[a]["field"];e[i]=t[a].value?t[a].value:""}return e},handleConfirm:function(){var e=this.isEdit?this.configData.approve_id:this.id;0==e&&(e=this.commandId),this.approveApplySave(e)},approveApplySave:function(e){var t=this,a={title:this.$t("hr.addposition"),method:"post",action:"approve/apply/save/".concat(e)};this.$refs.fc.$f.submit((function(e){Object.keys(e).forEach((function(t){void 0===e[t]&&(e[t]="")}));var i=t.examineData.list;if(i&&i.length){for(var n=0,o=0;o<i.length;o++){var l=i[o];if(!t.approverDelete&&1==l.types&&l.users.length<=0)return void t.$message.error("自选节点不能为空");if(!t.copyerDelete&&2==l.types&&l.users.length<=0)return void t.$message.error("自选节点不能为空");if(t.approverDelete&&1==l.types&&(4==l.settype||1==l.settype)&&l.users.length<=0)return void t.$message.error("自选节点不能为空");l.users.length<=0&&n++}if(n===i.length)return void t.$message.error("自选节点不能为空");i.forEach((function(e,t){e.users.length<=0&&i.splice(t,1)}))}var s={formInfo:e,processInfo:i};t.isEdit&&(s.apply_id=t.id),t.loading=!0,r["a"][a.method.toLowerCase()](a.action,s).then((function(e){t.loading=!1,t.close(),t.$emit("isOk")})).catch((function(e){t.loading=!1}))}))},attendanceAbnormalDate:function(){var e=this;Object(o["p"])().then((function(t){200==t.status&&(e.tryDateOptions=t.data,e.tryDateOptions=e.tryDateOptions.map((function(e){return e.label=e.date,e.value=e.id,e})))}))},attendanceAbnormalRecord:function(e){var t=this;Object(o["q"])(e).then((function(e){if(200==e.status){t.tryYiChangOptions=e.data,t.tryYiChangOptions=t.tryYiChangOptions.map((function(e){return e.value=e.shift_number,e.label=e.title+" : "+e.time,e}));for(var a=0;a<t.rules.length;a++)if("异常记录"===t.rules[a].title&&"refillFrom"===t.rules[a].calculateType){t.rules[a].options=t.tryYiChangOptions;break}}}))}}},d=u,f=(a("76c0"),a("2877")),m=Object(f["a"])(d,i,n,!1,null,"8a72bc06",null);t["default"]=m.exports}}]);